<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>nov-wechat page example</title>
    <link rel="icon" href="https://m.lenovo.com.cn/favicon.ico"/>
    <style>
        html, body{
            height: 100%;
            background-color: #f8f8f8;
            padding-top: 10px;
        }
        body{
            font-family: -apple-system-font, Helvetica Neue, Helvetica, sans-serif;
        }
    </style>
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <link rel="stylesheet" href="//res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">
    <script type="text/javascript" src="//res.wx.qq.com/open/libs/weuijs/1.1.3/weui.min.js"></script>
</head>
<body>
<div class="container">
    <div class="well">请在微信浏览器或微信开发者工具下打开</div>
    <div class="panel panel-primary">
    	<div class="panel-heading">设置JSSDK相关方法</div>
    	<div class="panel-body">
            <p>
                <code>initWechatShare</code> 和 <code>initWechatJSSDK</code>
                均返回Promise 对象。
            </p>
            <p>
                <button class="btn btn-danger" id="action-config">init share</button>
                <button class="btn btn-danger" id="action-update">update share</button>
            </p>
            <p>
                <button class="btn btn-danger" id="action-more-config">choose image</button>
            </p>
    	</div>
    </div>

    <div class="panel panel-danger">
    	<div class="panel-heading">获取openid 或者用户信息</div>
    	<div class="panel-body">
            <p>需要注意的是，正在执行location jump 时，此刻返回值可能为null，需要在代码里判断openid 的可用性</p>
            <p>在这个过程中网关会丢失hash 内容，所以我们将hash 存放在 SessionStorage 里 key = <code>nov-url-hash</code></p>

            <h3>getOpenid</h3>
            <p>
                <button class="btn btn-danger" id="action-get-openid">获取openid（静默授权）</button>
            </p>

            <h3>getUserInfo</h3>
            <p>
                <button class="btn btn-danger" id="action-get-openid-no-silence">获取userInfo（非静默授权）</button>
            </p>
    	</div>
        <div class="panel-footer">
            <button class="btn btn-info" id="action-set-dmp">设置DMP cookie</button>
        </div>
    </div>

</div>
<!-- built files will be auto injected -->

<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>
<script>
    $(function () {
        $("#action-config").click(function () {
            nov.initWechatShare({
                title: '嘿，这里是标题',
                desc: '狗年吉祥！'
            }).then(function(re) {
                if (re === 'success') {
                    console.log('用户确认分享后执行的回调函数')
                } else {
                    console.log('用户取消分享后执行的回调函数 re = cancel')
                }
            })
        })

        $("#action-update").click(function(){
            nov.initWechatShare({
                title: '分享的题目 更新'
            })
        })

        $("#action-more-config").click(function(){
            nov.initWechatJSSDK({
                jsApiList: ['chooseImage']
            }).then(wx => {
                wx.chooseImage({
                    count: 1, // 默认9
                    sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                    sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                    success: function (res) {
                        var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
                    }
                });
            }).catch(function(error) {
            	console.log(error)
            })
        })

        $("#action-get-openid").click(function(){
            let openid = nov.getOpenid()
            if (openid) {
                weui.alert('the openid is ' + openid)
            }
        })

        $("#action-get-openid-no-silence").click(function(){
            let userInfo = nov.getUserInfo()
            if (userInfo) {
                weui.alert('the userInfo is ' + userInfo)
                console.log(JSON.parse(userInfo))
            }
        })

        $("#action-set-dmp").click(function(){
            nov.setDmp(true)
            weui.topTips('设置完成 dmp = true')
        })
    })
</script>
</body>
</html>
